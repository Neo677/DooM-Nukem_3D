#include "env.h"

// Bitmap font 8x8 pour les chiffres 0-9 et lettres
// Chaque caractère = 8 bytes, chaque bit = 1 pixel
static const unsigned char font_8x8[128][8] = {
    // Chiffres 0x30-0x39
    [48] = {0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00},  // '0'
    [49] = {0x18, 0x38, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00},  // '1'
    [50] = {0x3C, 0x66, 0x06, 0x0C, 0x18, 0x30, 0x7E, 0x00},  // '2'
    [51] = {0x3C, 0x66, 0x06, 0x1C, 0x06, 0x66, 0x3C, 0x00},  // '3'
    [52] = {0x0C, 0x1C, 0x2C, 0x4C, 0x7E, 0x0C, 0x0C, 0x00},  // '4'
    [53] = {0x7E, 0x60, 0x7C, 0x06, 0x06, 0x66, 0x3C, 0x00},  // '5'
    [54] = {0x3C, 0x60, 0x7C, 0x66, 0x66, 0x66, 0x3C, 0x00},  // '6'
    [55] = {0x7E, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00},  // '7'
    [56] = {0x3C, 0x66, 0x66, 0x3C, 0x66, 0x66, 0x3C, 0x00},  // '8'
    [57] = {0x3C, 0x66, 0x66, 0x3E, 0x06, 0x0C, 0x38, 0x00},  // '9'
    
    // Lettres majuscules pour le menu
    [65] = {0x3C, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00},  // 'A'
    [68] = {0x7C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x7C, 0x00},  // 'D'
    [69] = {0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x7E, 0x00},  // 'E'
    [70] = {0x7E, 0x60, 0x60, 0x7C, 0x60, 0x60, 0x60, 0x00},  // 'F'
    [71] = {0x3C, 0x66, 0x60, 0x6E, 0x66, 0x66, 0x3C, 0x00},  // 'G'
    [73] = {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x7E, 0x00},  // 'I'
    [75] = {0x66, 0x6C, 0x78, 0x70, 0x78, 0x6C, 0x66, 0x00},  // 'K'
    [77] = {0x63, 0x77, 0x7F, 0x6B, 0x63, 0x63, 0x63, 0x00},  // 'M'
    [78] = {0x66, 0x76, 0x7E, 0x7E, 0x6E, 0x66, 0x66, 0x00},  // 'N'
    [79] = {0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00},  // 'O'
    [80] = {0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x00},  // 'P'
    [81] = {0x3C, 0x66, 0x66, 0x66, 0x6A, 0x6C, 0x36, 0x00},  // 'Q'
    [82] = {0x7C, 0x66, 0x66, 0x7C, 0x78, 0x6C, 0x66, 0x00},  // 'R'
    [83] = {0x3C, 0x66, 0x60, 0x3C, 0x06, 0x66, 0x3C, 0x00},  // 'S'
    [84] = {0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00},  // 'T'
    [85] = {0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00},  // 'U'
    
    // Minuscules
    [118] = {0x00, 0x00, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00},  // 'v'
    
    // Symboles
    [32] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},  // ' ' (espace)
    [46] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x18, 0x18, 0x00},  // '.'
    [58] = {0x00, 0x18, 0x18, 0x00, 0x18, 0x18, 0x00, 0x00},  // ':'
};

// Dessiner un caractère 8x8
static void draw_char(t_env *env, char c, int x, int y, Uint32 color)
{
    const unsigned char *glyph = font_8x8[(int)c];
    
    for (int row = 0; row < 8; row++)
    {
        for (int col = 0; col < 8; col++)
        {
            if (glyph[row] & (1 << (7 - col)))  // Tester le bit
            {
                int px = x + col;
                int py = y + row;
                if (px >= 0 && px < env->w && py >= 0 && py < env->h)
                    env->sdl.texture_pixels[px + py * env->w] = color;
            }
        }
    }
}

// Dessiner une chaîne de caractères
void    draw_text(t_env *env, const char *text, int x, int y, Uint32 color)
{
    int offset = 0;
    
    while (*text)
    {
        draw_char(env, *text, x + offset, y, color);
        offset += 8;  // 8 pixels de largeur par caractère
        text++;
    }
}

// Afficher les FPS à l'écran (en haut à gauche)
void    draw_fps_on_screen(t_env *env)
{
    char fps_text[32];
    
    // Construire la chaîne "FPS: XXX"
    snprintf(fps_text, sizeof(fps_text), "FPS: %d", env->fps);
    
    // Dessiner le texte en blanc
    draw_text(env, fps_text, 10, 10, 0xFFFFFFFF);
}
